<UserControl x:Class="Mobius.Views.Pages.LibraryPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:Mobius.Views.Controls"
             xmlns:models="clr-namespace:Mobius.Models"
             xmlns:conv="clr-namespace:Mobius.Converters">

    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>

        <Storyboard x:Key="ShakeStoryboard" RepeatBehavior="Forever">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)">
                <EasingDoubleKeyFrame KeyTime="0:0:0.0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.05" Value="-1.5"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.10" Value="1.5"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.15" Value="-1.2"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.20" Value="1.2"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.25" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <Style x:Key="AppItemPresenterStyle" TargetType="ContentPresenter">
            <Setter Property="Margin" Value="0,0,18,18"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform X="0"/>
                </Setter.Value>
            </Setter>

            <!-- ÐµÑÐ»Ð¸ Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð²ÐµÑ€Ð½Ñ‘ÑˆÑŒ DeleteMode â€“ Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ½Ð¾Ð²Ð° Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ shake -->
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.DeleteMode, RelativeSource={RelativeSource AncestorType=UserControl}}"
                             Value="True">
                    <DataTrigger.EnterActions>
                        <BeginStoryboard Storyboard="{StaticResource ShakeStoryboard}"/>
                    </DataTrigger.EnterActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- ÐœÐ¸Ð½Ð¸-ÐºÐ½Ð¾Ð¿ÐºÐ¸ + / âˆ’ -->
        <Style x:Key="MiniIconBtn" TargetType="Button">
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="{StaticResource GrayDarkBrush}"/>
            <Setter Property="BorderBrush" Value="#00000000"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Style="{StaticResource H1}" Margin="0,2,0,14">
            <Run Language="ru-ru" Text="Ð‘Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ°"/>
        </TextBlock>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Apps}">
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter" BasedOn="{StaticResource AppItemPresenterStyle}"/>
                </ItemsControl.ItemContainerStyle>

                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="2"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:AppEntryModel}">
                        <Grid>
                            <Grid.InputBindings>
                                <!-- ÐºÐ»Ð¸Ðº Ð¿Ð¾ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ: Ð·Ð°Ð¿ÑƒÑÐº/Ð²Ñ‹Ð±Ð¾Ñ€ -->
                                <MouseBinding MouseAction="LeftClick"
                                              Command="{Binding DataContext.CardClickCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              CommandParameter="{Binding}"/>
                            </Grid.InputBindings>

                            <controls:AppCard
                                SettingsCommand="{Binding DataContext.OpenAppSettingsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                SettingsCommandParameter="{Binding}"/>

                            <!-- Ð·Ð¾Ð½Ð° ÐºÐ»Ð¸ÐºÐ° Ð¿Ð¾ Ð¸ÐºÐ¾Ð½ÐºÐµ (Ð·Ð°Ð¼ÐµÐ½Ð° Ð¸ÐºÐ¾Ð½ÐºÐ¸) -->
                            <Border Width="52"
                                    Height="52"
                                    CornerRadius="14"
                                    Background="#00FFFFFF"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top">
                                <Border.InputBindings>
                                    <MouseBinding MouseAction="LeftClick"
                                                  Command="{Binding DataContext.ChangeIconCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                  CommandParameter="{Binding}"/>
                                </Border.InputBindings>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- ==================== APP SETTINGS (PHRASES) ==================== -->
        <Border Grid.RowSpan="2"
                Background="#AA000000"
                Visibility="{Binding IsAppSettingsOpen, Converter={StaticResource BoolToVis}}">
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Background="{StaticResource BgSurfaceBrush}"
                        CornerRadius="22"
                        Padding="16"
                        Width="520"
                        MaxHeight="520">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- header -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel>
                                <TextBlock Text="Ð¤Ñ€Ð°Ð·Ñ‹ Ð·Ð°Ð¿ÑƒÑÐºÐ°"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           FontSize="18"
                                           FontWeight="SemiBold"/>

                                <TextBlock Text="{Binding SelectedApp.Name}"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           Margin="0,4,0,0"
                                           TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                            <Button Grid.Column="1"
                                    Style="{StaticResource MiniWindowButton}"
                                    Background="{StaticResource RedBrush}"
                                    Content="+"
                                    ToolTip="Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"
                                    Command="{Binding CloseAppSettingsCommand}"/>
                        </Grid>

                        <!-- actions -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0"
                                    Style="{StaticResource IconButton}"
                                    Width="54"
                                    Background="{StaticResource GreenBrush}"
                                    Content="ï¼‹"
                                    ToolTip="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ„Ñ€Ð°Ð·Ñƒ"
                                    Command="{Binding AddPhraseCommand}"
                                    Margin="0,0,10,0"/>

                            <Button Grid.Column="1"
                                    Style="{StaticResource IconButton}"
                                    Width="54"
                                    Background="{StaticResource RedBrush}"
                                    Content="ðŸ§¹"
                                    ToolTip="ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÑ‘"
                                    Command="{Binding ClearPhrasesCommand}"
                                    Margin="0,0,10,0"/>

                            <TextBlock Grid.Column="2"
                                       Text="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹ Ð¿Ñ€ÑÐ¼Ð¾ Ð² ÑÐ¿Ð¸ÑÐºÐµ. ÐœÐ¸Ð½ÑƒÑ â€” ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€Ð¾ÐºÑƒ."
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       VerticalAlignment="Center"/>
                        </Grid>

                        <!-- phrases list -->
                        <ListBox Grid.Row="2"
                                 ItemsSource="{Binding SelectedApp.Phrases}"
                                 Background="{StaticResource BgSurface2Brush}"
                                 BorderBrush="#00000000"
                                 Padding="10"
                                 CornerRadius="18"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ListBox.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:PhraseModel}">
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Text="{Binding Text, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Background="{StaticResource BgWindowBrush}"
                                                 Foreground="{StaticResource TextPrimaryBrush}"
                                                 BorderBrush="#00000000"
                                                 Padding="10,6"
                                                 FontSize="14"
                                                 VerticalContentAlignment="Center"/>

                                        <Button Grid.Column="1"
                                                Style="{StaticResource MiniIconBtn}"
                                                Background="{StaticResource RedBrush}"
                                                Content="âˆ’"
                                                Margin="10,0,0,0"
                                                ToolTip="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                                Command="{Binding DataContext.RemovePhraseCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <!-- footer -->
                        <TextBlock Grid.Row="3"
                                   Text="Ð¤Ñ€Ð°Ð·Ñ‹ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ ÑÑ€Ð°Ð·Ñƒ. ÐŸÑƒÑÑ‚Ñ‹Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð»ÑƒÑ‡ÑˆÐµ ÑƒÐ´Ð°Ð»ÑÑ‚ÑŒ."
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="4,12,0,0"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        <!-- =============================================================== -->
    </Grid>
</UserControl>
