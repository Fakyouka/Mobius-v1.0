<Window x:Class="Mobius.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:Mobius.Converters"
        Title="Mobius"
        Width="980"
        Height="640"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">

    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>

        <conv:BoolToBrushConverter x:Key="SpeechBrush"
                                   TrueBrush="{StaticResource GreenBrush}"
                                   FalseBrush="{StaticResource RedBrush}"/>
    </Window.Resources>

    <Border Background="{StaticResource BgWindowBrush}"
            CornerRadius="22"
            SnapsToDevicePixels="True">

        <Grid Margin="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- TOP BAR (отдельная плашка светлее) -->
            <Border Grid.Row="0"
                    Background="{StaticResource BgSurfaceBrush}"
                    CornerRadius="18"
                    Padding="12"
                    Margin="0,0,0,10">
                <Grid MouseLeftButtonDown="TopBar_MouseLeftButtonDown">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Mobius"
                               Style="{StaticResource H1}"
                               VerticalAlignment="Center"
                               Margin="6,0,0,0"/>

                    <!-- Hide from Alt+Tab (gray minus) -->
                    <Button Grid.Column="1"
                            Style="{StaticResource MiniWindowButton}"
                            Content="−"
                            Margin="0,0,8,0"
                            ToolTip="Свернуть и скрыть из Alt+Tab"
                            Click="HideFromAltTab_Click"/>

                    <!-- Close (red plus) -->
                    <Button Grid.Column="2"
                            Style="{StaticResource MiniWindowButton}"
                            Background="{StaticResource RedBrush}"
                            Content="+"
                            ToolTip="Закрыть"
                            Click="Close_Click"/>
                </Grid>
            </Border>

            <!-- MAIN CONTENT AREA (отдельная плашка) -->
            <Border Grid.Row="1"
                    Background="{StaticResource BgWindowBrush}"
                    CornerRadius="18"
                    Padding="0"
                    Margin="0,0,0,10">
                <ContentControl Content="{Binding CurrentView}" />
            </Border>

            <!-- BOTTOM BAR -->
            <Border Grid.Row="2"
                    Background="{StaticResource PurpleBarBrush}"
                    CornerRadius="18"
                    Padding="14"
                    MinHeight="96">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Refresh (green) -->
                    <Button Grid.Column="0"
                            Style="{StaticResource IconButton}"
                            Background="{StaticResource GreenBrush}"
                            Content="⟳"
                            ToolTip="Обновить список"
                            Command="{Binding Library.RefreshCommand}"
                            Margin="0,0,10,0"/>

                    <!-- Speech Toggle (green/red) -->
                    <Button Grid.Column="1"
                            Style="{StaticResource IconButton}"
                            Background="{Binding Library.SpeechIsRunning, Converter={StaticResource SpeechBrush}}"
                            Content="{Binding Library.SpeechButtonLabel}"
                            ToolTip="Распознавание речи (вкл/выкл)"
                            Command="{Binding Library.ToggleSpeechCommand}"
                            Margin="0,0,10,0"/>

                   
                    <!-- Add local app -->
                    <Button Grid.Column="2"
                            Style="{StaticResource IconButton}"
                            Background="{StaticResource PurpleBar2Brush}"
                            Content="＋"
                            ToolTip="Добавить приложение (exe)"
                            Command="{Binding Library.AddAppCommand}"
                            Margin="0,0,10,0"/>

                    <!-- Settings (gray) -->
                    <Button Grid.Column="3"
                            Style="{StaticResource IconButton}"
                            Background="{StaticResource GrayDarkBrush}"
                            Content="⚙"
                            ToolTip="Настройки"
                            Command="{Binding Library.OpenSettingsCommand}"
                            Margin="0,0,10,0"/>

                    <TextBlock Grid.Column="5"
                               Text="Mobius • Library"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="14,0,0,0"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
